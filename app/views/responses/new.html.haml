.order-back
  = link_to manage_orders_path do
    %i.icon-caret-left
    %span Back to all Orders

  %p
  = render partial: 'partials/errors', locals: {object: @response}

.order
  .order__section
    %hgroup
      %div
        %em= "#{@order.location}, #{@order.user.country.name}"
    %table.table
      %tbody
        %tr
          %td= @order.user.first_name
          %td= @order.user.last_name
          %td= @order.user.pcv_id
          %td= @order.supply
          %td= @order.user.location
          %td= @order.user.country
          %td= @order.created_at.strftime '%-m/%-d/%y'
    .order__extra= @order.extra

  = form_for @response, url: order_response_path(@order, @response), html: {class: 'order__section'} do |f|
    %h4.order__method Fulfillment Method
    .row
      .col-md-4
        .order__message
          - DeliveryMethod.each do |method|
            %label.radio
              = f.radio_button :delivery_method, method.name, data: {message: method.text}
              = method.title
      .col-md-8
        Edit Default SMS --
        %span.order__characters "160 characters remaining"
        .order__instructions
          = f.text_area :instructions, size: "40x4", maxlength: 160, class: 'input-xlarge'
    .form-actions
      .btn-group
        %button.btn.btn-primary(type="submit") Send Response

%hr

%h2
  Past Orders
  %small
    for
    = @order.user.first_name
= render partial: "partials/pager", locals: { anchor: "order-history", pager: @history }

%table.table.table-striped.table-hover
  %thead
    %tr
      %th Date
      %th Supply
      %th
  - @history.each do |o|
    %tr
      - if @last_date.to_i == o.created_at.to_i
        %td
      - else
        %td= @last_date = o.created_at
      %td= o.supply
      %td
        - if o.response.denied?
          %i.glyphicon.glyphicon-remove
        - else
          %i.glyphicon.glyphicon-ok
        = o.response.instructions
